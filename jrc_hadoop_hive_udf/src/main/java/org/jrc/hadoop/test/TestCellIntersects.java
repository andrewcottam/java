package org.jrc.hadoop.test;

import java.nio.ByteBuffer;

import org.apache.hadoop.io.BytesWritable;
import org.jrc.EsriCellCalculator;
import org.json.JSONException;

import com.esri.core.geometry.Envelope;
import com.esri.core.geometry.GeometryEngine;
import com.esri.core.geometry.MapGeometry;
import com.esri.core.geometry.Polygon;
import com.esri.core.geometry.ogc.OGCGeometry;

public class TestCellIntersects {

	/**
	 * @param args
	 */
	public static void main(String[] args) {
		try {
			String geojson = "{'type':'Polygon','coordinates':[[[111.06529166600006,-1.7676805549999699],[111.06154166700009,-1.77537499999994],[111.05412500000006,-1.7859027779999792],[111.04498611100007,-1.8029861109999388],[111.04848611100005,-1.8187638889999675],[111.07243055600009,-1.8279583329999696],[111.09462500000006,-1.8533749999999714],[111.09462500000006,-1.8656527769999798],[111.08898611100005,-1.8709027769999693],[111.07548611100009,-1.8726527779999742],[111.06590277800007,-1.8704861109999342],[111.07418055500005,-1.8827361109999288],[111.07809722200005,-1.8871249999999691],[111.08615277800004,-1.8950138889999266],[111.10443055600007,-1.8875694439999506],[111.12490277700005,-1.9042083329999286],[111.12709722200009,-1.9142916669999295],[111.13709722300007,-1.9221805559999439],[111.15234722200006,-1.9274305559999334],[111.15581944400009,-1.9423472229999561],[111.14231944400007,-1.9581249999999386],[111.15148611100005,-1.9677638889999685],[111.17587500000008,-1.980458333999934],[111.18806944400006,-1.9865972219999435],[111.19504166700005,-1.9690694439999561],[111.20940277800008,-1.9524027779999642],[111.23159722200006,-1.9532916669999736],[111.23901388900003,-1.9594305559999725],[111.23640277800007,-1.9760694439999611],[111.22726388900008,-1.9975416669999504],[111.23162500000007,-2.0159583329999577],[111.22465277700007,-2.0282083329999523],[111.21462500000007,-2.0334861109999451],[111.20156944400009,-2.0343472219999512],[111.19284722200007,-2.0304305549999526],[111.18806944400006,-2.0207638879999763],[111.17934722200005,-2.0321805559999575],[111.16934722300005,-2.0343749999999545],[111.15104166700007,-2.0312916669999481],[111.13843055600006,-2.0308749999999804],[111.12970833300005,-2.0453194449999614],[111.11184722200005,-2.0505972219999649],[111.10748611100007,-2.0575972219999699],[111.08048611100008,-2.0650416669999458],[111.07179166700007,-2.0751249999999573],[111.05326388900005,-2.0902361109999674],[111.05065277800009,-2.0805972219999376],[111.04326388900006,-2.0762361109999574],[111.02626388900006,-2.068347221999943],[111.02887500000008,-2.0595694439999761],[111.02712500000007,-2.0424861109999597],[111.01190277700005,-2.0407361109999442],[111.00143055500007,-2.0433472229999552],[110.99970833300006,-2.0332638889999544],[110.98923611100008,-2.0394027779999533],[110.98184722200006,-2.0429305559999307],[110.97051388800008,-2.0420416669999781],[110.96312500000005,-2.0424861109999597],[110.96223611100004,-2.0328472219999298],[110.95593055500007,-2.0142083339999317],[110.94981944400007,-2.0085138889999712],[110.95026388900004,-2.0019305549999444],[110.92979166700007,-1.990986110999927],[110.92937500000005,-1.9787083329999291],[110.94548611100004,-1.9791527779999569],[110.93631944500004,-1.9695138889999271],[110.92848611100004,-1.9690694439999561],[110.91629166700005,-1.9677638889999685],[110.91804166700007,-1.9594305559999725],[110.92762500000003,-1.9423472229999561],[110.93501388900006,-1.9337916659999337],[110.93937500000004,-1.9215416659999391],[110.94895833400005,-1.913652777999971],[110.94809722200006,-1.9039861109999379],[110.95026388900004,-1.8952361109999742],[110.94940277800004,-1.8873472229999493],[110.94679166600008,-1.8842916659999673],[110.93806944400006,-1.8812083329999609],[110.94504166700005,-1.8687361109999756],[110.92762500000003,-1.8634583339999722],[110.91412500000007,-1.8709027769999693],[110.91759722200004,-1.884069444999966],[110.89931944400007,-1.8910694439999247],[110.89540277800006,-1.904652776999967],[110.88668055600004,-1.9125416659999246],[110.86448611100008,-1.9059583329999441],[110.86534722300007,-1.8897638889999371],[110.86209722200005,-1.8684861109999247],[110.85554166600008,-1.8570972219999362],[110.84770833300007,-1.8514027779999651],[110.84118055600004,-1.8356249999999363],[110.82681944500007,-1.8343194449999487],[110.81070833300004,-1.8400138889999766],[110.80023611100006,-1.8303749999999468],[110.79329166600007,-1.8215972219999799],[110.78979166700009,-1.8124027779999778],[110.78501388900008,-1.8089027779999469],[110.78587500000003,-1.7974861109999551],[110.79068055600004,-1.7821527769999648],[110.79459722200005,-1.7690138889999503],[110.80156944500004,-1.7611249999999359],[110.81440277800004,-1.7701249999999504],[110.81570833400008,-1.7569583339999326],[110.82181944500007,-1.7499583329999382],[110.82356944400004,-1.7381249999999682],[110.82051388900004,-1.7280416659999673],[110.81529166700005,-1.7201527769999529],[110.81398611100008,-1.710069444999931],[110.81704166700007,-1.6973749999999654],[110.82659722200009,-1.7092083329999355],[110.83662500000008,-1.7149027769999634],[110.84706944500005,-1.7140138889999434],[110.85187500000006,-1.7057083329999614],[110.84598611100006,-1.7010972219999303],[110.83726388800005,-1.6954027779999592],[110.83118055600005,-1.6901249999999663],[110.82812500000006,-1.6826805559999798],[110.82770833300009,-1.6734861109999315],[110.83293055600006,-1.6638472229999479],[110.83598611100007,-1.65245833299997],[110.84031944500003,-1.6419305559999771],[110.83640277800004,-1.6314027769999484],[110.83509722200006,-1.6204583329999309],[110.84426388900005,-1.6077638889999548],[110.85340277800009,-1.6055694449999578],[110.86645833300008,-1.607319443999927],[110.87648611100008,-1.5998749999999404],[110.88126388900008,-1.5910972229999629],[110.89259722200006,-1.5840972219999685],[110.90695833300003,-1.5840972219999685],[110.91915277800007,-1.5867083329999332],[110.91915277800007,-1.5976805559999434],[110.92654166600005,-1.6077638889999548],[110.92218055500007,-1.6198194439999725],[110.90912500000007,-1.614541666999969],[110.89606944400003,-1.6176249999999754],[110.88823611100008,-1.625513888999933],[110.89301388900009,-1.6390972219999753],[110.90737500000006,-1.6561805549999349],[110.91654166700005,-1.6689027779999606],[110.92393055600007,-1.6780972219999626],[110.93004166700007,-1.68379166699998],[110.93306944500006,-1.6938749999999345],[110.94745833300004,-1.695180554999979],[110.95440277800009,-1.7048194449999414],[110.95831944400004,-1.7197361109999747],[110.96093055600005,-1.7100972219999448],[110.95529166700004,-1.696930555999927],[110.95615277800005,-1.688624999999945],[110.95484722200007,-1.68379166699998],[110.94831944500004,-1.6745972229999779],[110.95570833400006,-1.6601249999999368],[110.96573611100007,-1.6531249999999318],[110.97443055600007,-1.6491805559999761],[110.97531944500008,-1.6399583339999708],[110.97706944400005,-1.6259583329999714],[110.97837500000009,-1.6167361109999661],[110.98751388900007,-1.6132361109999351],[111.00623611200007,-1.6105972219999671],[111.01623611100007,-1.6123472219999258],[111.02234722200006,-1.620680555999968],[111.01623611100007,-1.625069443999962],[111.00534722300006,-1.625069443999962],[110.99404166600004,-1.6285694439999361],[110.99318055600008,-1.6404027779999524],[111.00404166700008,-1.6474305559999607],[111.00970833400004,-1.6548749999999472],[111.01537500000006,-1.6504861109999638],[111.01973611200009,-1.6531249999999318],[111.01537500000006,-1.6645138889999771],[111.01581944400004,-1.6719583329999637],[111.02279166700004,-1.6815972219999367],[111.02173611100005,-1.6849305559999266],[111.03043055600006,-1.6817638889999671],[111.04123611200004,-1.6786249999999541],[111.04681944400005,-1.685986110999977],[111.05098611100004,-1.694402777999926],[111.04926388900009,-1.7038749999999254],[111.05412500000006,-1.7105138889999694],[111.05901388900008,-1.712263888999928],[111.07504166700005,-1.7017638879999595],[111.07956944400007,-1.7045694439999579],[111.08723611100004,-1.7115694449999523],[111.08581944400004,-1.7171805559999598],[111.07920833300005,-1.7206805549999444],[111.07434722200009,-1.7238472219999608],[111.06737500000008,-1.7336527769999748],[111.06179166700008,-1.7403194439999652],[111.05343055600008,-1.7515416669999695],[111.06354166700004,-1.7550416659999541],[111.07051388900004,-1.7582083329999705],[111.06529166600006,-1.7676805549999699]]]}";
			MapGeometry mapGeom = GeometryEngine.geometryFromGeoJson(geojson, 0, com.esri.core.geometry.Geometry.Type.Polygon);
			Polygon poly = (Polygon) mapGeom.getGeometry();
			OGCGeometry ogc = OGCGeometry.createFromEsriGeometry(poly, null);
			ByteBuffer wkb = ogc.asBinary();
			byte[] byteArr = wkb.array();
			BytesWritable bw = new BytesWritable(byteArr);

			//set test variables
			Long cell = (long) 31252;
			Double cellSize = 1.0; 
			//get the geometry to test
			OGCGeometry ogcGeometry = OGCGeometry.fromBinary(ByteBuffer.wrap(bw.getBytes()));
			//get the envelope of the cell
			EsriCellCalculator cellCalculator = new EsriCellCalculator();
			boolean firstRun = true;
		    if (firstRun) {
		        cellCalculator.setCellSize(cellSize);
		        firstRun = false;
		      }
			Envelope envelope = cellCalculator.getCellEnvelope(cell);
			OGCGeometry ogcEnvelope = OGCGeometry.createFromEsriGeometry(envelope, null);
			//get the intersection of the cell and the geometry
			OGCGeometry intersection = ogcGeometry.intersection(ogcEnvelope);
			System.out.println("wibble");

		} catch (JSONException e) {
			e.printStackTrace();
		}
	}

}
